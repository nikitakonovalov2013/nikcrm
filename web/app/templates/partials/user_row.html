{% set is_oob = is_oob if is_oob is defined else False %}
<tr id="row-{{ u.id }}"{% if is_oob %} hx-swap-oob="outerHTML"{% endif %} class="row-hover">
  <td data-label="TG ID" class="crm-field"><span class="crm-value crm-breakable">{{ u.tg_id }}</span></td>
  <td data-label="Цвет" class="crm-field"><span class="crm-value"><span class="user-color-dot" style="background: {{ u.color or '#94a3b8' }}"></span> <span class="muted">{{ u.color or '' }}</span></span></td>
  <td data-label="Имя" class="crm-field"><span class="crm-value">{{ u.first_name or '' }}</span></td>
  <td data-label="Фамилия" class="crm-field"><span class="crm-value">{{ u.last_name or '' }}</span></td>
  <td data-label="Дата рождения" class="crm-field crm-wide"><span class="crm-value crm-nowrap">{{ format_date(u.birth_date) }}</span></td>
  <td data-label="Ставка, ₽" class="crm-field"><span class="crm-value crm-nowrap">{{ (u.rate_k ~ ' ₽') if u.rate_k is not none else '' }}</span></td>
  <td data-label="График" class="crm-field"><span class="crm-value crm-nowrap">{{ u.schedule or '' }}</span></td>
  <td data-label="Должность" class="crm-field crm-wide"><span class="crm-value">{{ u.position or '' }}</span></td>
  {% set status_map = {
    'PENDING': 'На рассмотрении',
    'APPROVED': 'Одобрен',
    'REJECTED': 'Отклонён',
    'BLACKLISTED': 'В чёрном списке'
  } %}
  <td data-label="Статус" class="crm-field crm-wide"><span class="crm-value"><span class="badge {{ u.status.value if u.status else '' }}">{{ status_map[u.status.value] if u.status else '' }}</span></span></td>
  <td data-label="Действия" class="actions-cell crm-actions">
    <button
      type="button"
      class="icon-btn"
      title="Редактировать"
      aria-label="Редактировать"
      hx-get="users/{{ u.id }}"
      hx-target="#modal-body"
      hx-swap="innerHTML"
      hx-on:click="event.stopPropagation(); (function(){ const b=document.getElementById('modal-body'); if(b){ b.innerHTML='<div class=\'modal-loading\'>Загрузка…</div>'; } })()"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
    </button>
    <button
      type="button"
      class="icon-btn warn"
      title="Удалить"
      aria-label="Удалить"
      hx-on:click="event.stopPropagation(); window.openDeleteConfirm({{ u.id }})"
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
    </button>
  </td>
</tr>
