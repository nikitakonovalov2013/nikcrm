{% extends base_template %}
{% block title %}График работы{% endblock %}
{% block content %}
<div class="tasks-header">
  <div>
    <h2 class="subtitle">График работы</h2>
    <div class="muted">План и фактические смены</div>
  </div>
  <div class="tasks-header-actions">
    <button class="btn" type="button" id="schedule-emergency">⚡ Экстренная смена</button>
    <button class="btn-outline" type="button" id="schedule-today">Сегодня</button>
  </div>
</div>

<div class="schedule-toolbar">
  <div class="schedule-toolbar-left">
    <div class="schedule-quick">
      <div class="schedule-quick-title">Быстрая разметка:</div>
      <button class="btn-outline schedule-quick-btn" type="button" data-quick="preset_10_18">10:00–18:00 (8 часов)</button>
      <button class="btn-outline schedule-quick-btn" type="button" data-quick="preset_10_20">10:00–20:00 (10 часов)</button>
      <button class="btn-outline schedule-quick-btn" type="button" data-quick="preset_10_22">10:00–22:00 (12 часов)</button>
      <button class="btn-outline schedule-quick-btn" type="button" data-quick="custom">Своё время</button>
      <button class="btn-outline schedule-quick-btn" type="button" data-quick="off">Выходной</button>
      <button class="btn-outline schedule-quick-btn" type="button" data-quick="clear">Очистить</button>
      <button class="btn-outline schedule-quick-btn" type="button" data-quick="">Снять режим</button>
      <span id="schedule-quick-time-wrap" style="display:none">
        <div class="schedule-quick-title" style="margin-left:12px">Время:</div>
        <input class="input" type="time" id="schedule-quick-start" value="10:00" style="width:110px" />
        <div class="muted">—</div>
        <input class="input" type="time" id="schedule-quick-end" value="18:00" style="width:110px" />
      </span>
    </div>
  </div>
  <div class="schedule-toolbar-right" id="schedule-user-wrap" style="display:none">
    <div class="schedule-user-label">Сотрудник:</div>
    <select class="input" id="schedule-user"></select>
  </div>
</div>

<div class="schedule-cal">
  <div class="schedule-cal-head">
    <button class="btn-outline" type="button" id="schedule-prev">←</button>
    <div class="schedule-cal-title" id="schedule-title">—</div>
    <button class="btn-outline" type="button" id="schedule-next">→</button>
  </div>

  <div class="schedule-cal-weekdays">
    <div>Пн</div><div>Вт</div><div>Ср</div><div>Чт</div><div>Пт</div><div>Сб</div><div>Вс</div>
  </div>

  <div class="schedule-cal-grid" id="schedule-grid"></div>

  <div class="schedule-legend">
    <div class="schedule-legend-item"><span class="schedule-dot work"></span><span>Рабочий день</span></div>
    <div class="schedule-legend-item"><span class="schedule-dot off"></span><span>Выходной</span></div>
    <div class="schedule-legend-item"><span class="schedule-dot none"></span><span>Экстренная ⚡</span></div>
    <div class="schedule-legend-item"><span class="schedule-dot none"></span><span>Не задано</span></div>
  </div>
</div>

<link rel="stylesheet" href="{{ url_for('static', path='schedule.css') }}" />
<script>
  window.SCHEDULE_USERS = {{ users_json|default('[]')|safe }};
  window.SCHEDULE_IS_ADMIN = {% if is_admin %}true{% else %}false{% endif %};
  window.SCHEDULE_IS_MANAGER = {% if is_manager %}true{% else %}false{% endif %};
</script>
<script defer src="{{ url_for('static', path='schedule.js') }}"></script>
{% endblock %}
